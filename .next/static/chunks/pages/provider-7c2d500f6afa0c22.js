(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[423],{1473:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/provider",function(){return t(7960)}])},7960:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>n});var r=t(7876),i=t(4232),s=t(7685);let l="https://khedme-api.onrender.com";function n(){var e,a;let t,n,[d,o]=(0,i.useState)([]),[c,m]=(0,i.useState)([]),[p,u]=(0,i.useState)([]),[g,h]=(0,i.useState)([]),[x,b]=(0,i.useState)(!0),[y,v]=(0,i.useState)("available"),[f,j]=(0,i.useState)(null),[N,_]=(0,i.useState)(!1),[w,S]=(0,i.useState)(!1),[A,C]=(0,i.useState)({full_name:"",phone:"",category_id:"",district_id:""});async function k(){if(f){_(!0);try{let e=!f.available,a=await fetch(`${l}/api/providers/update-status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider_id:f.id,available:e})}),t=await a.json();if(t.success){let a={...f,available:e};j(a),localStorage.setItem("provider",JSON.stringify(a)),s.Ay.success(e?"You are now Available ✅":"You are now Unavailable \uD83D\uDEAB")}else s.Ay.error(t.message||"Failed to update availability")}catch(e){console.error("toggleAvailability error:",e),s.Ay.error("Network error updating status")}finally{_(!1)}}}async function $(e){if(e.preventDefault(),!f)return;_(!0);let a={id:f.id,full_name:A.full_name,phone:A.phone,category_id:""===A.category_id?null:Number(A.category_id),district_id:""===A.district_id?null:Number(A.district_id)};try{let e=await fetch(`${l}/api/providers/update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await e.json();t.success?(j(t.provider),localStorage.setItem("provider",JSON.stringify(t.provider)),s.Ay.success("Profile updated ✅"),S(!1)):s.Ay.error(t.message||"Failed to update profile")}catch(e){console.error("handleProfileUpdate error:",e),s.Ay.error("Network error while saving profile")}finally{_(!1)}}async function P(e){if(!f)return void s.Ay.error("Please log in");try{let a=await fetch(`${l}/api/providers/apply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:e,provider_id:f.id,message:"I'm interested in this job"})}),t=await a.json();t.success?(s.Ay.success("Application submitted ✅"),m(a=>[{application_id:t.application?.id??Date.now(),job_id:e,status:"pending",message:t.application?.message??"No message"},...a])):s.Ay.error(t.message||"Failed to apply")}catch(e){console.error("handleApply error:",e),s.Ay.error("Network error applying to job")}}return((0,i.useEffect)(()=>{let e=(()=>{try{return JSON.parse(localStorage.getItem("provider"))}catch{return null}})();if(!e){s.Ay.error("No provider found — please log in"),b(!1);return}j(e),C({full_name:e.full_name||"",phone:e.phone||"",category_id:e.category_id??"",district_id:e.district_id??""}),async function(){try{let[a,t,r]=await Promise.all([fetch(`${l}/api/jobs/all`),fetch(`${l}/api/providers/applications/${e.id}`),fetch(`${l}/api/meta`)]),i=await a.json(),s=await t.json(),n=await r.json();o(i.jobs||[]),m(s.applications||[]),u(n.categories||[]),h(n.districts||[])}catch(e){console.error("Error fetching dashboard data:",e),s.Ay.error("Failed to load data")}finally{b(!1)}}()},[]),x)?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[70vh]",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600 font-medium",children:"Loading dashboard..."})]}):(0,r.jsx)("div",{className:"min-h-screen bg-orange-50 py-10",children:(0,r.jsxs)("div",{className:"max-w-5xl mx-auto bg-white rounded-2xl shadow-md p-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-orange-600 mb-6 text-center",children:"Provider Dashboard"}),f&&(0,r.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-gray-800",children:f.full_name||"Unnamed Provider"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["ID: ",f.id," • Category: ",(e=f.category_id,(t=p.find(a=>Number(a.id)===Number(e)))?t.name||t.name_en||t.name_ar||String(t.id):"—")," • District: ",(a=f.district_id,(n=g.find(e=>Number(e.id)===Number(a)))?n.name||n.name_en||n.name_ar||String(n.id):"—")]}),(0,r.jsxs)("p",{className:"text-sm mt-1",children:["Status: ",(0,r.jsx)("span",{className:`font-medium ${f.available?"text-green-600":"text-red-600"}`,children:f.available?"Available":"Unavailable"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:k,disabled:N,className:`px-4 py-2 rounded-md text-white font-medium transition ${f.available?"bg-green-500 hover:bg-green-600":"bg-gray-400 hover:bg-gray-500"}`,children:N?"Updating...":f.available?"Set Unavailable":"Set Available"}),(0,r.jsx)("button",{onClick:()=>S(!w),className:"px-4 py-2 bg-orange-500 text-white rounded-md font-medium hover:bg-orange-600 transition",children:w?"Cancel":"Edit Profile"})]})]}),w&&(0,r.jsxs)("form",{onSubmit:$,className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Full name"}),(0,r.jsx)("input",{className:"w-full border rounded-md p-2",value:A.full_name,onChange:e=>C({...A,full_name:e.target.value}),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Phone"}),(0,r.jsx)("input",{className:"w-full border rounded-md p-2",value:A.phone,onChange:e=>C({...A,phone:e.target.value}),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Category"}),(0,r.jsxs)("select",{className:"w-full border rounded-md p-2",value:A.category_id??"",onChange:e=>C({...A,category_id:e.target.value}),required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select category"}),p.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name||e.name_en||e.name_ar||e.id},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"District"}),(0,r.jsxs)("select",{className:"w-full border rounded-md p-2",value:A.district_id??"",onChange:e=>C({...A,district_id:e.target.value}),required:!0,children:[(0,r.jsx)("option",{value:"",children:"Select district"}),g.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name||e.name_en||e.name_ar||e.id},e.id))]})]}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)("button",{type:"submit",disabled:N,className:"w-full bg-orange-500 text-white py-2 rounded-md hover:bg-orange-600 transition",children:N?"Saving...":"Save Changes"})})]})]}),(0,r.jsxs)("div",{className:"flex justify-center mb-6 space-x-4",children:[(0,r.jsx)("button",{onClick:()=>v("available"),className:`px-4 py-2 rounded-md font-medium ${"available"===y?"bg-orange-500 text-white":"bg-gray-100 text-gray-700"}`,children:"Available Jobs"}),(0,r.jsx)("button",{onClick:()=>v("applications"),className:`px-4 py-2 rounded-md font-medium ${"applications"===y?"bg-orange-500 text-white":"bg-gray-100 text-gray-700"}`,children:"My Applications"})]}),"available"===y?(0,r.jsx)("div",{className:"space-y-4",children:0===d.length?(0,r.jsx)("p",{className:"text-center text-gray-500",children:"No jobs available yet."}):d.map(e=>{let a=c.some(a=>Number(a.job_id)===Number(e.id));return(0,r.jsx)("div",{className:"border border-gray-200 rounded-lg p-5 shadow-sm bg-white",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-800 text-lg",children:e.service}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["District: ",e.district]}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:e.description}),(0,r.jsxs)("p",{className:"text-orange-600 font-semibold mt-2",children:["$",parseFloat(e.budget).toFixed(2)]})]}),(0,r.jsx)("div",{className:"w-40 flex items-center justify-end",children:(0,r.jsx)("button",{onClick:()=>P(e.id),disabled:a,className:`ml-4 py-2 px-4 rounded-md font-medium transition ${a?"bg-orange-100 text-gray-500 cursor-not-allowed":"bg-orange-500 text-white hover:bg-orange-600"}`,children:a?"Already Applied":"Apply"})})]})},e.id)})}):(0,r.jsx)("div",{className:"space-y-4",children:0===c.length?(0,r.jsx)("p",{className:"text-center text-gray-500",children:"You haven’t applied for any jobs yet."}):c.map(e=>(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 shadow-sm",children:[(0,r.jsxs)("p",{className:"font-semibold text-gray-800 flex items-center justify-between",children:[(0,r.jsxs)("span",{children:["Job #",e.job_id," — ",e.service?e.service:""]}),(0,r.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"approved"===e.status?"bg-green-100 text-green-700":"pending"===e.status?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:e.status})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:e.message})]},e.application_id||e.id))})]})})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=1473)),_N_E=e.O()}]);