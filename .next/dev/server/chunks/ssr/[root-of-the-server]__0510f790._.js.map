{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///D:/Khedme/Khedme-Web/pages/provider.js"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { Briefcase, ClipboardList, CheckCircle, XCircle, Loader2 } from \"lucide-react\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nexport default function ProviderDashboard() {\r\n  const [provider, setProvider] = useState(null);\r\n  const [jobs, setJobs] = useState([]);\r\n  const [applications, setApplications] = useState([]);\r\n  const [activeTab, setActiveTab] = useState(\"jobs\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // ‚úÖ Load provider data from localStorage\r\n  useEffect(() => {\r\n    const storedProvider = JSON.parse(localStorage.getItem(\"provider\"));\r\n    if (storedProvider) setProvider(storedProvider);\r\n  }, []);\r\n\r\n  // ‚úÖ Fetch all jobs\r\n  useEffect(() => {\r\n    if (!provider) return;\r\n    setLoading(true);\r\n    fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/jobs/all`)\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        setJobs(data.jobs || []);\r\n        setLoading(false);\r\n      })\r\n      .catch(() => {\r\n        toast.error(\"Failed to load jobs\");\r\n        setLoading(false);\r\n      });\r\n  }, [provider]);\r\n\r\n  // ‚úÖ Fetch provider's applications\r\n  const fetchApplications = async () => {\r\n    if (!provider) return;\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/providers/applications/${provider.id}`);\r\n      const data = await res.json();\r\n      if (data.success) setApplications(data.applications || []);\r\n      else toast.error(\"Failed to fetch applications\");\r\n    } catch {\r\n      toast.error(\"Error loading applications\");\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (activeTab === \"applications\") fetchApplications();\r\n  }, [activeTab]);\r\n\r\n  // ‚úÖ Apply to a job\r\n  const handleApply = async (jobId) => {\r\n    if (!provider) return toast.error(\"Please log in first\");\r\n    const message = prompt(\"Enter a short message for your application:\");\r\n    if (!message) return;\r\n\r\n    try {\r\n      const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/api/providers/apply`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ job_id: jobId, provider_id: provider.id, message }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        toast.success(\"Application submitted!\");\r\n        fetchApplications(); // refresh\r\n      } else {\r\n        toast.error(\"Failed to apply\");\r\n      }\r\n    } catch {\r\n      toast.error(\"Server error\");\r\n    }\r\n  };\r\n\r\n  const renderStatusBadge = (status) => {\r\n    const colors = {\r\n      pending: \"bg-yellow-100 text-yellow-700 border-yellow-300\",\r\n      approved: \"bg-green-100 text-green-700 border-green-300\",\r\n      rejected: \"bg-red-100 text-red-700 border-red-300\",\r\n    };\r\n    return (\r\n      <span className={`text-xs font-semibold px-2 py-1 rounded border ${colors[status] || \"bg-gray-100 text-gray-700 border-gray-300\"}`}>\r\n        {status.charAt(0).toUpperCase() + status.slice(1)}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-white text-black p-6\">\r\n      <h1 className=\"text-3xl font-bold text-orange-500 mb-6\">Provider Dashboard</h1>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"flex space-x-4 mb-8 border-b border-gray-200\">\r\n        <button\r\n          onClick={() => setActiveTab(\"jobs\")}\r\n          className={`pb-2 px-3 font-semibold ${activeTab === \"jobs\" ? \"border-b-2 border-orange-500 text-orange-600\" : \"text-gray-600 hover:text-orange-500\"}`}\r\n        >\r\n          <Briefcase className=\"inline mr-2 w-4 h-4\" /> Available Jobs\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab(\"applications\")}\r\n          className={`pb-2 px-3 font-semibold ${activeTab === \"applications\" ? \"border-b-2 border-orange-500 text-orange-600\" : \"text-gray-600 hover:text-orange-500\"}`}\r\n        >\r\n          <ClipboardList className=\"inline mr-2 w-4 h-4\" /> My Applications\r\n        </button>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      {loading ? (\r\n        <div className=\"flex justify-center py-10 text-gray-500\">\r\n          <Loader2 className=\"animate-spin w-6 h-6 mr-2\" /> Loading...\r\n        </div>\r\n      ) : activeTab === \"jobs\" ? (\r\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {jobs.map(job => (\r\n            <div key={job.id} className=\"border rounded-2xl p-5 shadow-sm hover:shadow-md transition\">\r\n              <h2 className=\"font-semibold text-lg text-gray-900\">{job.service}</h2>\r\n              <p className=\"text-sm text-gray-600 mt-1\">{job.description}</p>\r\n              <div className=\"text-sm text-gray-500 mt-2\">\r\n                <span className=\"block\">üìç {job.district}</span>\r\n                <span className=\"block\">üí∞ {job.budget} USD</span>\r\n              </div>\r\n              <button\r\n                onClick={() => handleApply(job.id)}\r\n                className=\"mt-4 w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 rounded-xl transition\"\r\n              >\r\n                Apply Now\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {applications.length === 0 ? (\r\n            <p className=\"text-gray-500\">No applications yet.</p>\r\n          ) : (\r\n            applications.map(app => (\r\n              <div key={app.application_id} className=\"border rounded-2xl p-5 shadow-sm hover:shadow-md transition\">\r\n                <h2 className=\"font-semibold text-lg text-gray-900\">{app.service}</h2>\r\n                <p className=\"text-sm text-gray-600 mt-1\">{app.description}</p>\r\n                <div className=\"text-sm text-gray-500 mt-2\">\r\n                  <span className=\"block\">üìç {app.district}</span>\r\n                  <span className=\"block\">üí∞ {app.budget} USD</span>\r\n                </div>\r\n                <p className=\"text-sm text-gray-700 mt-3 italic\">\"{app.message}\"</p>\r\n                <div className=\"mt-3 flex items-center justify-between\">\r\n                  {renderStatusBadge(app.status)}\r\n                  {app.status === \"approved\" && <CheckCircle className=\"w-5 h-5 text-green-500\" />}\r\n                  {app.status === \"rejected\" && <XCircle className=\"w-5 h-5 text-red-500\" />}\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}