{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///D:/Khedme/Khedme-Web/src/pages/provider/index.js"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { toast } from \"react-hot-toast\";\r\n\r\nexport default function ProviderDashboard() {\r\n  const API_BASE = process.env.NEXT_PUBLIC_API_URL || \"https://khedme-api.onrender.com\";\r\n  const [provider, setProvider] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [applications, setApplications] = useState([]);\r\n  const [loadingApps, setLoadingApps] = useState(false);\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editData, setEditData] = useState({ full_name: \"\", category_id: \"\", district_id: \"\" });\r\n\r\n  /* ‚úÖ Load provider data */\r\n  useEffect(() => {\r\n    const stored = localStorage.getItem(\"provider\");\r\n    if (stored) {\r\n      const parsed = JSON.parse(stored);\r\n      setProvider(parsed);\r\n      setEditData({\r\n        full_name: parsed.full_name || \"\",\r\n        category_id: parsed.category_id || \"\",\r\n        district_id: parsed.district_id || \"\",\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  /* ‚úÖ Toggle availability */\r\n  const toggleAvailability = async () => {\r\n    if (!provider) return toast.error(\"Provider not found\");\r\n\r\n    const newStatus = !provider.available;\r\n    setLoading(true);\r\n\r\n    try {\r\n      const res = await fetch(`${API_BASE}/api/providers/availability`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          provider_id: provider.id,\r\n          is_available: newStatus,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (data.success) {\r\n        toast.success(data.message);\r\n        const updated = { ...provider, available: newStatus };\r\n        localStorage.setItem(\"provider\", JSON.stringify(updated));\r\n        setProvider(updated);\r\n        window.dispatchEvent(new Event(\"providerUpdated\"));\r\n      } else {\r\n        toast.error(data.message || \"Failed to update status\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"‚ùå Toggle availability error:\", error);\r\n      toast.error(\"Server error updating availability\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  /* ‚úÖ Fetch My Applications */\r\n  const fetchApplications = async () => {\r\n    if (!provider?.id) return;\r\n    setLoadingApps(true);\r\n    try {\r\n      const res = await fetch(`${API_BASE}/api/providers/applications/${provider.id}`);\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        setApplications(data.applications);\r\n      } else {\r\n        toast.error(\"Failed to load applications\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"‚ùå Error fetching applications:\", err);\r\n      toast.error(\"Error loading applications\");\r\n    } finally {\r\n      setLoadingApps(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (provider?.id) fetchApplications();\r\n  }, [provider]);\r\n\r\n  /* ‚úÖ Handle profile save */\r\n  const handleSaveProfile = async () => {\r\n    if (!provider) return;\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(`${API_BASE}/api/providers/update`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          id: provider.id,\r\n          full_name: editData.full_name,\r\n          category_id: editData.category_id,\r\n          district_id: editData.district_id,\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        toast.success(\"Profile updated successfully ‚úÖ\");\r\n        localStorage.setItem(\"provider\", JSON.stringify(data.provider));\r\n        setProvider(data.provider);\r\n        setShowModal(false);\r\n      } else {\r\n        toast.error(data.message || \"Failed to update profile\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"‚ùå Profile update error:\", err);\r\n      toast.error(\"Server error updating profile\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"max-w-4xl mx-auto mt-10 p-6 bg-white shadow-md rounded-2xl border border-gray-100\">\r\n        <h1 className=\"text-2xl font-bold text-gray-800 mb-4\">Provider Dashboard</h1>\r\n\r\n        {provider ? (\r\n          <>\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <div>\r\n                <p className=\"text-gray-600 mb-1\">\r\n                  Welcome, <span className=\"text-orange-600 font-semibold\">{provider.full_name}</span>\r\n                </p>\r\n                <p className=\"text-sm text-gray-500\">Phone: (hidden for privacy)</p>\r\n              </div>\r\n\r\n              <Button\r\n                onClick={() => setShowModal(true)}\r\n                className=\"bg-orange-500 hover:bg-orange-600 text-white px-4 py-1 text-sm\"\r\n              >\r\n                ‚úèÔ∏è Edit Profile\r\n              </Button>\r\n            </div>\r\n\r\n            {/* üîò Availability Toggle */}\r\n            <Button\r\n              onClick={toggleAvailability}\r\n              disabled={loading}\r\n              className={`px-6 py-2 rounded-full font-semibold transition-all duration-300 ${\r\n                provider.available\r\n                  ? \"bg-green-500 hover:bg-green-600 text-white\"\r\n                  : \"bg-gray-400 hover:bg-gray-500 text-white\"\r\n              }`}\r\n            >\r\n              {loading\r\n                ? \"Updating...\"\r\n                : provider.available\r\n                ? \"Available ‚úÖ\"\r\n                : \"Unavailable ‚ùå\"}\r\n            </Button>\r\n\r\n            {/* üßæ My Applications */}\r\n            <div className=\"mt-10\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <h2 className=\"text-xl font-semibold text-gray-800\">My Applications</h2>\r\n                <Button\r\n                  onClick={fetchApplications}\r\n                  disabled={loadingApps}\r\n                  className=\"bg-orange-500 hover:bg-orange-600 text-white px-3 py-1\"\r\n                >\r\n                  {loadingApps ? \"Refreshing...\" : \"üîÑ Refresh\"}\r\n                </Button>\r\n              </div>\r\n\r\n              {loadingApps ? (\r\n                <p className=\"text-gray-500\">Loading applications...</p>\r\n              ) : applications.length === 0 ? (\r\n                <p className=\"text-gray-500\">No job applications found.</p>\r\n              ) : (\r\n                <div className=\"grid gap-4\">\r\n                  {applications.map((app) => (\r\n                    <div\r\n                      key={app.application_id}\r\n                      className=\"border border-orange-100 rounded-xl p-4 shadow-sm hover:shadow-md transition\"\r\n                    >\r\n                      <div className=\"flex justify-between items-center mb-2\">\r\n                        <h3 className=\"font-semibold text-gray-800\">{app.service}</h3>\r\n                        <span\r\n                          className={`text-sm px-3 py-1 rounded-full font-medium ${\r\n                            app.status === \"approved\"\r\n                              ? \"bg-green-100 text-green-700\"\r\n                              : app.status === \"rejected\"\r\n                              ? \"bg-red-100 text-red-700\"\r\n                              : \"bg-yellow-100 text-yellow-700\"\r\n                          }`}\r\n                        >\r\n                          {app.status}\r\n                        </span>\r\n                      </div>\r\n                      <p className=\"text-gray-700 text-sm mb-2\">{app.description}</p>\r\n                      <p className=\"text-gray-500 text-xs\">\r\n                        District: {app.district} ‚Ä¢ Budget: ${app.budget}\r\n                      </p>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <p className=\"text-gray-500 text-center\">No provider data found.</p>\r\n        )}\r\n      </div>\r\n\r\n      {/* ü™ü Edit Profile Modal */}\r\n      {showModal && (\r\n        <div className=\"fixed inset-0 bg-black/40 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-xl shadow-lg p-6 w-full max-w-md\">\r\n            <h2 className=\"text-xl font-semibold text-gray-800 mb-4\">Edit Profile</h2>\r\n\r\n            <div className=\"space-y-3\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Full Name\"\r\n                value={editData.full_name}\r\n                onChange={(e) => setEditData({ ...editData, full_name: e.target.value })}\r\n                className=\"w-full border rounded-lg px-3 py-2\"\r\n              />\r\n              <input\r\n                type=\"number\"\r\n                placeholder=\"Category ID\"\r\n                value={editData.category_id}\r\n                onChange={(e) => setEditData({ ...editData, category_id: e.target.value })}\r\n                className=\"w-full border rounded-lg px-3 py-2\"\r\n              />\r\n              <input\r\n                type=\"number\"\r\n                placeholder=\"District ID\"\r\n                value={editData.district_id}\r\n                onChange={(e) => setEditData({ ...editData, district_id: e.target.value })}\r\n                className=\"w-full border rounded-lg px-3 py-2\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex justify-end gap-3 mt-5\">\r\n              <Button\r\n                onClick={() => setShowModal(false)}\r\n                className=\"bg-gray-300 hover:bg-gray-400 text-black\"\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                onClick={handleSaveProfile}\r\n                className=\"bg-orange-500 hover:bg-orange-600 text-white\"\r\n                disabled={loading}\r\n              >\r\n                {loading ? \"Saving...\" : \"Save Changes\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}