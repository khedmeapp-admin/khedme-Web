{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///D:/Khedme/Khedme-Web/pages/auth.js"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport toast, { Toaster } from \"react-hot-toast\";\r\n\r\nexport default function AuthPage() {\r\n  const router = useRouter();\r\n  const [role, setRole] = useState(\"provider\");\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [otp, setOtp] = useState(\"\");\r\n  const [providerId, setProviderId] = useState(\"\");\r\n  const [step, setStep] = useState(1);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Step 1: Request OTP\r\n  const requestOtp = async () => {\r\n    if (!phone.startsWith(\"+961\")) {\r\n      toast.error(\"Please use a valid Lebanese number (+961...)\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"https://khedme-api.onrender.com/auth/request-otp\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ phone, role }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.message);\r\n\r\n      toast.success(data.message || \"OTP sent ‚úÖ\");\r\n      setProviderId(data.providerId || \"\");\r\n      setStep(2);\r\n    } catch (err) {\r\n      toast.error(err.message || \"Something went wrong ‚ùå\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Step 2: Verify OTP\r\n  const verifyOtp = async () => {\r\n    if (!otp.trim()) {\r\n      toast.error(\"Enter the OTP code\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"https://khedme-api.onrender.com/auth/verify-otp\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ providerId, otp }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.message);\r\n\r\n      toast.success(\"Phone verified successfully üéâ\");\r\n\r\n      // Save temporary session\r\n      localStorage.setItem(\"providerId\", providerId);\r\n      localStorage.setItem(\"phone\", phone);\r\n      localStorage.setItem(\"role\", role);\r\n\r\n      setStep(3);\r\n\r\n      // Redirect based on role\r\n      setTimeout(() => {\r\n        if (role === \"provider\") router.push(\"/provider\");\r\n        else router.push(\"/post-job\");\r\n      }, 1500);\r\n    } catch (err) {\r\n      toast.error(err.message || \"Invalid OTP ‚ùå\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-orange-600 to-black text-white px-4\">\r\n      <Toaster\r\n        position=\"top-center\"\r\n        toastOptions={{\r\n          style: {\r\n            background: \"#FF6600\",\r\n            color: \"white\",\r\n            fontWeight: \"bold\",\r\n            borderRadius: \"10px\",\r\n          },\r\n        }}\r\n      />\r\n\r\n      <div className=\"bg-black/50 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center backdrop-blur-md\">\r\n        {/* Step 1: Role + Request OTP */}\r\n        {step === 1 && (\r\n          <>\r\n            <h1 className=\"text-2xl font-bold mb-4\">Sign in to Khedme</h1>\r\n\r\n            <div className=\"flex justify-center gap-3 mb-6\">\r\n              <button\r\n                className={`px-4 py-2 rounded-lg font-semibold transition-all ${\r\n                  role === \"provider\"\r\n                    ? \"bg-orange-500 text-white\"\r\n                    : \"bg-gray-200 text-black hover:bg-gray-300\"\r\n                }`}\r\n                onClick={() => setRole(\"provider\")}\r\n              >\r\n                Provider\r\n              </button>\r\n              <button\r\n                className={`px-4 py-2 rounded-lg font-semibold transition-all ${\r\n                  role === \"client\"\r\n                    ? \"bg-orange-500 text-white\"\r\n                    : \"bg-gray-200 text-black hover:bg-gray-300\"\r\n                }`}\r\n                onClick={() => setRole(\"client\")}\r\n              >\r\n                Client\r\n              </button>\r\n            </div>\r\n\r\n            <input\r\n              type=\"tel\"\r\n              placeholder=\"+961XXXXXXXX\"\r\n              value={phone}\r\n              onChange={(e) => setPhone(e.target.value)}\r\n              onKeyDown={(e) => e.key === \"Enter\" && requestOtp()}\r\n              className=\"w-full p-3 rounded-lg mb-4 text-black focus:ring-2 focus:ring-orange-400 outline-none\"\r\n            />\r\n\r\n            <button\r\n              onClick={requestOtp}\r\n              disabled={loading}\r\n              className=\"bg-orange-500 hover:bg-orange-600 w-full py-3 rounded-lg font-semibold transition-all disabled:opacity-70\"\r\n            >\r\n              {loading ? \"Sending...\" : `Request OTP (${role})`}\r\n            </button>\r\n          </>\r\n        )}\r\n\r\n        {/* Step 2: Enter OTP */}\r\n        {step === 2 && (\r\n          <>\r\n            <h1 className=\"text-2xl font-bold mb-4\">Enter OTP</h1>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"123456\"\r\n              value={otp}\r\n              onChange={(e) => setOtp(e.target.value)}\r\n              onKeyDown={(e) => e.key === \"Enter\" && verifyOtp()}\r\n              className=\"w-full p-3 rounded-lg mb-4 text-black focus:ring-2 focus:ring-orange-400 outline-none\"\r\n            />\r\n            <button\r\n              onClick={verifyOtp}\r\n              disabled={loading}\r\n              className=\"bg-orange-500 hover:bg-orange-600 w-full py-3 rounded-lg font-semibold transition-all disabled:opacity-70\"\r\n            >\r\n              {loading ? \"Verifying...\" : \"Verify OTP\"}\r\n            </button>\r\n            <button\r\n              onClick={() => setStep(1)}\r\n              className=\"mt-4 text-orange-300 hover:underline text-sm\"\r\n            >\r\n              ‚Üê Change phone number\r\n            </button>\r\n          </>\r\n        )}\r\n\r\n        {/* Step 3: Verified */}\r\n        {step === 3 && (\r\n          <div className=\"space-y-2\">\r\n            <h1 className=\"text-3xl font-bold mb-2 text-green-400\">‚úÖ Verified!</h1>\r\n            <p className=\"text-gray-200\">Welcome to Khedme</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}