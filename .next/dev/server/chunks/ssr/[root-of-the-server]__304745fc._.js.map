{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///D:/Khedme/Khedme-Web/src/pages/jobs.js"],"sourcesContent":["// src/pages/jobs.js\r\nimport { useEffect, useState } from \"react\";\r\nimport toast from \"react-hot-toast\";\r\nimport { CheckCircle } from \"lucide-react\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nexport default function JobsPage() {\r\n  const API_BASE = \"https://khedme-api.onrender.com\";\r\n  const [jobs, setJobs] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [provider, setProvider] = useState(null);\r\n  const [appliedJobs, setAppliedJobs] = useState([]);\r\n  const [justApplied, setJustApplied] = useState(null);\r\n\r\n  // ‚úÖ Load provider from localStorage\r\n  useEffect(() => {\r\n    const stored = localStorage.getItem(\"provider\");\r\n    if (stored) setProvider(JSON.parse(stored));\r\n  }, []);\r\n\r\n  // ‚úÖ Fetch all jobs\r\n  useEffect(() => {\r\n    const fetchJobs = async () => {\r\n      try {\r\n        const res = await fetch(`${API_BASE}/api/jobs/all`);\r\n        const data = await res.json();\r\n        if (data.success) setJobs(data.jobs);\r\n        else toast.error(\"Failed to load jobs\");\r\n      } catch (err) {\r\n        console.error(err);\r\n        toast.error(\"Error fetching jobs\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchJobs();\r\n  }, []);\r\n\r\n  // ‚úÖ Fetch provider's applications\r\n  useEffect(() => {\r\n    if (!provider) return;\r\n    const fetchApplications = async () => {\r\n      try {\r\n        const res = await fetch(`${API_BASE}/api/providers/applications/${provider.id}`);\r\n        const data = await res.json();\r\n        if (data.success) {\r\n          const ids = data.applications.map((a) => a.job_id);\r\n          setAppliedJobs(ids);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Error fetching applications:\", err);\r\n      }\r\n    };\r\n    fetchApplications();\r\n  }, [provider]);\r\n\r\n  // ‚úÖ Handle Apply Now\r\n  const handleApply = async (jobId) => {\r\n    if (!provider) {\r\n      toast.error(\"Please log in as a provider first.\");\r\n      return;\r\n    }\r\n\r\n    if (appliedJobs.includes(jobId)) {\r\n      toast(\"‚ö†Ô∏è You already applied for this job\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(`${API_BASE}/api/providers/apply`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          job_id: jobId,\r\n          provider_id: provider.id,\r\n          message: \"I'm interested in this job.\",\r\n        }),\r\n      });\r\n\r\n      const data = await res.json();\r\n      if (data.success) {\r\n        toast.success(\"Application sent successfully ‚úÖ\");\r\n        setAppliedJobs((prev) => [...prev, jobId]);\r\n        setJustApplied(jobId);\r\n\r\n        // reset after short pulse animation\r\n        setTimeout(() => setJustApplied(null), 1200);\r\n\r\n        // optional event to refresh navbar/applications\r\n        window.dispatchEvent(new Event(\"applicationAdded\"));\r\n      } else {\r\n        toast.error(data.message || \"Failed to apply\");\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(\"Error submitting application\");\r\n    }\r\n  };\r\n\r\n  // ‚úÖ UI\r\n  if (loading)\r\n    return <p className=\"text-center mt-10 text-gray-500\">Loading jobs...</p>;\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto p-6\">\r\n      <h1 className=\"text-3xl font-bold text-orange-600 mb-6 text-center\">\r\n        Available Jobs\r\n      </h1>\r\n\r\n      {jobs.length === 0 ? (\r\n        <p className=\"text-center text-gray-500\">No jobs available right now.</p>\r\n      ) : (\r\n        <div className=\"grid md:grid-cols-2 gap-6\">\r\n          {jobs.map((job) => {\r\n            const alreadyApplied = appliedJobs.includes(job.id);\r\n            const isPulsing = justApplied === job.id;\r\n\r\n            return (\r\n              <motion.div\r\n                key={job.id}\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                className={`relative border border-gray-200 rounded-2xl p-5 shadow-sm hover:shadow-md transition ${\r\n                  alreadyApplied ? \"bg-gray-50 opacity-90\" : \"bg-white\"\r\n                }`}\r\n              >\r\n                {/* ‚úÖ Applied Badge */}\r\n                {alreadyApplied && (\r\n                  <motion.div\r\n                    animate={\r\n                      isPulsing\r\n                        ? { scale: [1, 1.3, 1], opacity: [1, 0.8, 1] }\r\n                        : { scale: 1, opacity: 1 }\r\n                    }\r\n                    transition={{ duration: 1, ease: \"easeInOut\" }}\r\n                    className=\"absolute top-3 right-3 flex items-center gap-1 text-green-600 bg-green-100 px-2 py-1 rounded-full text-xs font-medium\"\r\n                  >\r\n                    <CheckCircle size={14} /> Applied\r\n                  </motion.div>\r\n                )}\r\n\r\n                <h2 className=\"text-xl font-semibold text-gray-800 mb-2\">\r\n                  {job.service}\r\n                </h2>\r\n                <p className=\"text-gray-600 mb-2\">{job.description}</p>\r\n                <p className=\"text-sm text-gray-500\">üìç {job.district}</p>\r\n                <p className=\"text-sm text-gray-500 mb-4\">\r\n                  üí∞ Budget: ${job.budget}\r\n                </p>\r\n\r\n                <motion.button\r\n                  whileTap={{ scale: 0.97 }}\r\n                  animate={\r\n                    justApplied === job.id\r\n                      ? { backgroundColor: [\"#f97316\", \"#22c55e\", \"#9ca3af\"] }\r\n                      : {}\r\n                  }\r\n                  transition={{ duration: 1 }}\r\n                  onClick={() => handleApply(job.id)}\r\n                  disabled={alreadyApplied}\r\n                  className={`w-full py-2 rounded-lg font-medium transition ${\r\n                    alreadyApplied\r\n                      ? \"bg-gray-400 text-white cursor-not-allowed\"\r\n                      : \"bg-orange-500 hover:bg-orange-600 text-white\"\r\n                  }`}\r\n                >\r\n                  {alreadyApplied ? \"Already Applied ‚úÖ\" : \"Apply Now\"}\r\n                </motion.button>\r\n              </motion.div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}