{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///D:/Khedme/Khedme-Web/pages/auth.js"],"sourcesContent":["// pages/auth.js\r\nimport { useState } from \"react\";\r\nimport { toast } from \"sonner\";\r\n\r\nexport default function AuthPage() {\r\n  const [phone, setPhone] = useState(\"+961\");\r\n  const [otp, setOtp] = useState(\"\");\r\n  const [step, setStep] = useState(\"phone\"); // \"phone\" or \"verify\" or \"done\"\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const API = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:4000\";\r\n\r\n  // Step 1: Request OTP\r\n  const sendOtp = async (e) => {\r\n    e.preventDefault();\r\n    if (!phone || !phone.startsWith(\"+961\") || phone.length < 8) {\r\n      toast.error(\"أدخل رقم هاتف لبناني صالح يبدأ ب +961\");\r\n      return;\r\n    }\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`${API}/auth/request-otp`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ phone }),\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.message || \"Failed to send OTP\");\r\n      toast.success(\"رمز التحقق أُرسل — أدخله للتحقق.\");\r\n      // Save providerId in localStorage for demo (if returned)\r\n      if (data.providerId) localStorage.setItem(\"khedme_providerId\", data.providerId);\r\n      setStep(\"verify\");\r\n    } catch (err) {\r\n      console.error(\"sendOtp:\", err);\r\n      toast.error(err.message || \"تعذر إرسال الرمز\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Step 2: Verify OTP\r\n  const verifyOtp = async (e) => {\r\n    e.preventDefault();\r\n    if (!otp || otp.length < 4) {\r\n      toast.error(\"أدخل رمز التحقق (OTP)\");\r\n      return;\r\n    }\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`${API}/auth/verify-otp`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ phone, otp }),\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.message || \"Verification failed\");\r\n      // For demo we just store a flag in localStorage\r\n      localStorage.setItem(\"khedme_authenticated\", \"true\");\r\n      localStorage.setItem(\"khedme_user_phone\", phone);\r\n      toast.success(\"تم التحقق — تم تسجيل الدخول!\");\r\n      setStep(\"done\");\r\n    } catch (err) {\r\n      console.error(\"verifyOtp:\", err);\r\n      toast.error(err.message || \"رمز خاطئ\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem(\"khedme_authenticated\");\r\n    localStorage.removeItem(\"khedme_user_phone\");\r\n    localStorage.removeItem(\"khedme_providerId\");\r\n    setPhone(\"+961\");\r\n    setOtp(\"\");\r\n    setStep(\"phone\");\r\n    toast(\"تم تسجيل الخروج\");\r\n  };\r\n\r\n  // If already logged in (quick client-side check)\r\n  const isAuthed = typeof window !== \"undefined\" && localStorage.getItem(\"khedme_authenticated\") === \"true\";\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-b from-orange-50 to-white p-6\">\r\n      <div className=\"w-full max-w-md bg-white/95 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-orange-100\">\r\n        <h1 className=\"text-2xl font-bold text-orange-600 mb-4 text-center\">تسجيل الدخول / تسجيل مزوّد</h1>\r\n\r\n        {isAuthed || step === \"done\" ? (\r\n          <div className=\"text-center space-y-4\">\r\n            <p className=\"text-gray-700\">أنت الآن مسجل الدخول كـ <span className=\"font-semibold text-orange-600\">{localStorage.getItem(\"khedme_user_phone\")}</span></p>\r\n            <div className=\"flex justify-center gap-3\">\r\n              <button onClick={() => (window.location.href = \"/provider\")} className=\"px-4 py-2 bg-black text-white rounded-lg\">Go to Provider</button>\r\n              <button onClick={logout} className=\"px-4 py-2 bg-orange-100 text-orange-600 rounded-lg\">تسجيل خروج</button>\r\n            </div>\r\n          </div>\r\n        ) : step === \"phone\" ? (\r\n          <form onSubmit={sendOtp} className=\"space-y-4\">\r\n            <label className=\"block text-right text-sm text-gray-600\">رقم الهاتف (لبنان، ابدأ بـ +961)</label>\r\n            <input\r\n              value={phone}\r\n              onChange={(e) => setPhone(e.target.value)}\r\n              className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-orange-300 text-right\"\r\n              placeholder=\"+96171xxxxxxx\"\r\n            />\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className={`w-full py-3 rounded-lg font-semibold text-white ${loading ? \"bg-orange-300\" : \"bg-orange-500 hover:bg-orange-600\"}`}\r\n            >\r\n              {loading ? \"جاري الإرسال...\" : \"أرسل رمز التحقق\"}\r\n            </button>\r\n          </form>\r\n        ) : (\r\n          // verify step\r\n          <form onSubmit={verifyOtp} className=\"space-y-4\">\r\n            <p className=\"text-right text-sm text-gray-600\">أدخل رمز التحقق المكوّن من 6 أرقام</p>\r\n            <input\r\n              value={otp}\r\n              onChange={(e) => setOtp(e.target.value)}\r\n              className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-orange-300 text-center\"\r\n              placeholder=\"123456\"\r\n            />\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className={`flex-1 py-3 rounded-lg font-semibold text-white ${loading ? \"bg-orange-300\" : \"bg-orange-500 hover:bg-orange-600\"}`}\r\n              >\r\n                {loading ? \"جاري التحقق...\" : \"تحقق وادخل\"}\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setStep(\"phone\")}\r\n                className=\"py-3 px-4 rounded-lg bg-gray-100 text-gray-700\"\r\n              >\r\n                عد\r\n              </button>\r\n            </div>\r\n          </form>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}