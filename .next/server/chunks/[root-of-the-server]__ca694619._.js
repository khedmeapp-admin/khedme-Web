module.exports=[22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},5048,e=>e.a(async(t,r)=>{try{var i=e.i(22734),a=e.i(14747),n=e.i(30056),s=t([n]);[n]=s.then?(await s)():s;let{Pool:l}=n.default,d=new l({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});async function o(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let r=[];for await(let t of e)r.push(t);let n=Buffer.concat(r).toString("latin1"),s=n.split("\r\n")[0],o=n.split(s).filter(e=>e.includes("Content-Disposition")),l={},p={};o.forEach(e=>{let[t,...r]=e.split("\r\n"),i=t.match(/name="([^"]+)"/)?.[1],a=t.match(/filename="([^"]+)"/)?.[1],n=r.slice(2,-2).join("\r\n");a?p[i]={filename:a,buffer:Buffer.from(n,"latin1")}:l[i]=n.replace(/\r\n$/,"")});let{branch:u,service:c,district:f,phone:h,bio:v,price:m}=l;if(!u||!c||!f||!h||!v||!m||!p.idFile||!p.selfieFile)return t.status(400).json({message:"Missing fields or files"});let g=a.default.join(process.cwd(),"uploads");i.default.existsSync(g)||i.default.mkdirSync(g);let w=`/uploads/${Date.now()}_id.jpg`,y=`/uploads/${Date.now()}_selfie.jpg`;i.default.writeFileSync(a.default.join(process.cwd(),w),p.idFile.buffer),i.default.writeFileSync(a.default.join(process.cwd(),y),p.selfieFile.buffer);let{rows:$}=await d.query(`INSERT INTO providers(branch, service, district, phone, bio, price, id_doc, selfie, approved, created_at)
       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, false, NOW()) RETURNING id`,[u,c,f,h,v,m,w,y]);console.log(`[PROVIDER-${$[0].id}] New ${c} provider in ${f} – phone ${h}`),t.status(201).json({message:"Application received – pending approval",id:$[0].id})}catch(e){console.error("[PROVIDER]",e),t.status(500).json({message:"Server error"})}}e.s(["config",0,{api:{bodyParser:!1}},"default",()=>o]),r()}catch(e){r(e)}},!1),31054,e=>e.a(async(t,r)=>{try{var i=e.i(26747),a=e.i(90406),n=e.i(44898),s=e.i(62950),o=e.i(5048),l=e.i(7031),d=e.i(81927),p=e.i(46432),u=t([o]);[o]=u.then?(await u)():u;let f=(0,s.hoist)(o,"default"),h=(0,s.hoist)(o,"config"),v=new n.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/providers",pathname:"/api/providers",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function c(e,t,r){v.isDev&&(0,p.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/providers";a=a.replace(/\/index$/,"")||"/";let n=await v.prepare(e,t,{srcPage:a});if(!n){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:s,params:o,prerenderManifest:u,routerServerContext:c}=n;try{let r=e.method||"GET",i=(0,l.getTracer)(),n=i.getActiveScopeSpan(),p=v.instrumentationOnRequestError.bind(v),f=async n=>v.render(e,t,{query:{...s,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:v.isDev,page:"/api/providers",internalRevalidate:null==c?void 0:c.revalidate,onError:(...t)=>p(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=i.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=e.get("next.route");if(s){let e=`${r} ${s}`;n.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),n.updateName(e)}else n.updateName(`${r} ${a}`)});n?await f(n):await i.withPropagatedContext(e.headers,()=>i.trace(d.BaseServerSpan.handleRequest,{spanName:`${r} ${a}`,kind:l.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},f))}catch(e){if(v.isDev)throw e;(0,i.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,h,"default",0,f,"handler",()=>c]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__ca694619._.js.map